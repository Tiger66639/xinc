<?xml version="1.0"?>
<project name="Xinc Build File For Unit Tests" basedir="." default="test">	
	<property file="xinc.properties"/>
	<fileset dir="classes" id="xinc-all-classes">
		<include name="*/**/*.php"/>
		</fileset>
	<fileset dir="test/classes" id="xinc-test-setup">
			<include name="Xinc/Setup/*.php"/>
			<include name="Xinc/Engine/SunriseCannotValidate.php"/>
			<include name="*.php"/>
		</fileset>
	<fileset dir="test/classes" id="xinc-core-tests">
		<include name="Xinc/Test*.php"/>
		<include name="Test*.php"/>
	</fileset>
	<fileset dir="test/classes" id="xinc-project-tests">
			<include name="Xinc/Project/**/Test*.php"/>
		</fileset>
	<fileset dir="test/classes" id="xinc-config-tests">
				<include name="Xinc/Config/**/Test*.php"/>
			</fileset>
	<fileset dir="test/classes" id="xinc-build-tests">
					<include name="Xinc/Build/**/Test*.php"/>
				</fileset>
	<fileset dir="test/classes" id="xinc-engine-tests">
						<include name="Xinc/Engine/**/Test*.php"/>
					</fileset>
	<fileset dir="test/classes" id="xinc-modificationset-tests">
		<include name="Xinc/ModificationSet/**/Test*.php"/>
	</fileset>

	<fileset dir="test/classes" id="xinc-publisher-tests">
		<include name="Xinc/Publisher/**/Test*.php"/>
	</fileset>
	
	<fileset dir="test/classes" id="xinc-builder-tests">
		<include name="Xinc/Builder/**/Test*.php"/>
	</fileset>
	<fileset dir="test/classes" id="xinc-plugin-tests">
			<include name="Xinc/Plugin/**/Test*.php"/>
		</fileset>
	<!-- start unit test configuration -->
	<target name="prepare">
		<includepath classpath="${project.basedir}/classes" />
		<mkdir dir="${report.dir}"/>
		<mkdir dir="${report.dir}/${coverage.subdir}"/>
		<!--<delete dir="examples/alchemy"/>-->
	</target>

	<target name="generate-report">
  		<phpunitreport infile="${report.dir}/logfile.xml" styledir="resources/xsl" todir="report" format="noframes"/>
		
  	</target>

	<target name="test" depends="test-all,generate-report,coverage-teardown">
  		<fail if="test-failed" message="The Unit Tests Have Failed! please fix me"/>
  	</target>

	<target name="coverage-setup">
  		
  		<coverage-setup database="report/coverage/database">
  			 <fileset dir="classes">
  			 <include name="**/*.php"/>
  			 </fileset>
  			<!--<fileset dir="test/classes">
  			  			 <include name="**/*.php"/>
  			  			 </fileset>-->
  			
  		</coverage-setup>
 		
	</target>
	
	<target name="coverage-teardown">
		
		  		<coverage-report outfile="report/coverage/coverage.xml">
		  			<report styledir="resources/xsl"
		  			todir="report/coverage"
		  			/>
		  		</coverage-report>
		
	</target>
<target name="lintcheck">
	<phplint haltonfailure="true">
	                                <fileset refid="xinc-all-classes"/>
	                                
	        </phplint>
	</target>
	<target name="test-all" depends="lintcheck,prepare,coverage-setup">
	    	<includepath classpath="classes" /> 
	        <includepath classpath="test/classes" /> 
		
	    	
		<phpunit3 codecoverage="true" printsummary="true" haltonerror="false" haltonfailure="false" errorproperty="test-failed" failureproperty="test-failed">
	      		<batchtest>
	      			<fileset refid="xinc-test-setup"/>
	        		<fileset refid="xinc-core-tests"/>
	      			<fileset refid="xinc-project-tests"/>
	      			<fileset refid="xinc-config-tests"/>
	      			<fileset refid="xinc-engine-tests"/>
	      			<fileset refid="xinc-build-tests"/>
	      			<fileset refid="xinc-modificationset-tests"/>
	      			<fileset refid="xinc-builder-tests"/>
	      			<fileset refid="xinc-plugin-tests"/>
	      			<fileset refid="xinc-publisher-tests"/>
	      		</batchtest>
	      		<formatter type="xml" todir="${report.dir}" outfile="logfile.xml"/>	    
			</phpunit3>
		
	</target>

  	<target name="test-core" depends="prepare">
    	<includepath classpath="classes" /> 
        <includepath classpath="test/classes" /> 
    	<phpunit printsummary="true" haltonerror="false" haltonfailure="false" errorproperty="test-failed" failureproperty="test-failed">
      		<batchtest>
        		<fileset refid="xinc-core-tests"/>
    	    </batchtest>
      		<formatter type="xml" todir="${report.dir}" outfile="logfile.xml"/>	    
		</phpunit>
  	</target>

  	<target name="test-publishers" depends="prepare">
    	<includepath classpath="classes" /> 
        <includepath classpath="test/classes" /> 
    	<phpunit printsummary="true" haltonerror="false" haltonfailure="false" errorproperty="test-failed" failureproperty="test-failed">
      		<batchtest>
        		<fileset refid="xinc-publisher-tests"/>
    	    </batchtest>
      		<formatter type="xml" todir="${report.dir}" outfile="logfile.xml"/>	    
		</phpunit>
  	</target>

	<target name="test-modificationsets" depends="prepare">
	    	<includepath classpath="classes" /> 
	        <includepath classpath="test/classes" /> 
	    	<phpunit printsummary="true" haltonerror="false" haltonfailure="false" errorproperty="test-failed" failureproperty="test-failed">
	      		<batchtest>
	        		<fileset refid="xinc-modificationset-tests"/>
	    	    </batchtest>
	      		<formatter type="xml" todir="${report.dir}" outfile="logfile.xml"/>	    
			</phpunit>
	</target>
	
	<target name="test-builders" depends="prepare">
    	<includepath classpath="classes" /> 
        <includepath classpath="test/classes" /> 
    	<phpunit printsummary="true" haltonerror="false" haltonfailure="false" errorproperty="test-failed" failureproperty="test-failed">
      		<batchtest>
        		<fileset refid="xinc-builder-tests"/>
    	    </batchtest>
      		<formatter type="xml" todir="${report.dir}" outfile="logfile.xml"/>	    
		</phpunit>
  	</target>

</project>